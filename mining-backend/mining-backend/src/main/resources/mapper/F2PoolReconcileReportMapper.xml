<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.slb.mining_backend.modules.xmr.mapper.F2PoolReconcileReportMapper">

    <resultMap id="F2PoolReconcileReportResultMap" type="com.slb.mining_backend.modules.xmr.entity.F2PoolReconcileReport">
        <id property="id" column="id"/>
        <result property="account" column="account"/>
        <result property="coin" column="coin"/>
        <result property="reportTime" column="report_time"/>
        <result property="overviewHashrateHps" column="overview_hashrate_hps"/>
        <result property="workersHashrateHps" column="workers_hashrate_hps"/>
        <result property="hashrateDiffRatio" column="hashrate_diff_ratio"/>
        <result property="grossAmountCoin" column="gross_amount_coin"/>
        <result property="settlementGrossCoin" column="settlement_gross_coin"/>
        <result property="revenueDiffRatio" column="revenue_diff_ratio"/>
        <result property="status" column="status"/>
        <result property="createdTime" column="created_time"/>
    </resultMap>

    <insert id="insert" parameterType="com.slb.mining_backend.modules.xmr.entity.F2PoolReconcileReport" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO f2pool_reconcile_report
        (account, coin, report_time, overview_hashrate_hps, workers_hashrate_hps, hashrate_diff_ratio,
         gross_amount_coin, settlement_gross_coin, revenue_diff_ratio, status, created_time)
        VALUES
        (#{account}, #{coin}, #{reportTime}, #{overviewHashrateHps}, #{workersHashrateHps}, #{hashrateDiffRatio},
         #{grossAmountCoin}, #{settlementGrossCoin}, #{revenueDiffRatio}, #{status}, #{createdTime})
    </insert>

    <select id="findLatest" resultMap="F2PoolReconcileReportResultMap">
        SELECT *
        FROM f2pool_reconcile_report
        WHERE account = #{account}
          AND coin = #{coin}
        ORDER BY report_time DESC
        LIMIT #{limit}
    </select>

</mapper>
