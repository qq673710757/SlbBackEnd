<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.slb.mining_backend.modules.xmr.mapper.F2PoolPayoutDailyMapper">

    <resultMap id="F2PoolPayoutDailyResultMap" type="com.slb.mining_backend.modules.xmr.entity.F2PoolPayoutDaily">
        <id property="id" column="id"/>
        <result property="account" column="account"/>
        <result property="coin" column="coin"/>
        <result property="payoutDate" column="payout_date"/>
        <result property="grossAmount" column="gross_amount"/>
        <result property="txId" column="tx_id"/>
        <result property="source" column="source"/>
        <result property="status" column="status"/>
        <result property="payloadFingerprint" column="payload_fingerprint"/>
        <result property="createdTime" column="created_time"/>
    </resultMap>

    <insert id="insertIgnore" parameterType="com.slb.mining_backend.modules.xmr.entity.F2PoolPayoutDaily" useGeneratedKeys="true" keyProperty="id">
        INSERT IGNORE INTO f2pool_payout_daily
        (account, coin, payout_date, gross_amount, tx_id, source, status, payload_fingerprint, created_time)
        VALUES
        (#{account}, #{coin}, #{payoutDate}, #{grossAmount}, #{txId}, #{source}, #{status}, #{payloadFingerprint}, #{createdTime})
    </insert>

    <select id="selectEarliestUnsettled" resultMap="F2PoolPayoutDailyResultMap">
        SELECT *
        FROM f2pool_payout_daily
        WHERE account = #{account}
          AND coin = #{coin}
          AND status = 'NEW'
        ORDER BY payout_date ASC
        LIMIT 1
    </select>

    <select id="selectByAccountAndDate" resultMap="F2PoolPayoutDailyResultMap">
        SELECT *
        FROM f2pool_payout_daily
        WHERE account = #{account}
          AND coin = #{coin}
          AND payout_date = #{payoutDate}
        LIMIT 1
    </select>

    <update id="updateStatus">
        UPDATE f2pool_payout_daily
        SET status = #{status}
        WHERE id = #{id}
    </update>

</mapper>
